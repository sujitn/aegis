# Changelog

All notable changes to Aegis.

## [Unreleased]

### Added
- Project documentation and specifications
- F001: Project Foundation - Cargo workspace with 6 crates (aegis-core, aegis-storage, aegis-server, aegis-ui, aegis-tray, aegis-app)
- F002: Keyword Classifier - Fast regex-based classifier (<1ms) with patterns for Violence, SelfHarm, Adult, Jailbreak, Hate, Illegal categories
- F003: Prompt Guard ML - ONNX-based ML classifier using Meta's Prompt Guard model for jailbreak/injection detection (<50ms), optional `ml` feature, graceful fallback when model missing
- F004: Tiered Classification - Pipeline orchestrating keyword and ML classifiers with short-circuit on high-confidence matches (<25ms), SafetyClassifier trait, ClassificationTier tracking, graceful degradation when ML unavailable
- F008: SQLite Storage - Privacy-preserving database with events (hash+preview), rules (JSON), config, auth, and daily stats aggregation
- F005: Time Rules - Time-based blocking with day-of-week selection, overnight ranges, enable/disable, and default presets (school night/weekend bedtimes)
- F006: Content Rules - Category-to-action mapping (block/warn/allow) with configurable thresholds and family-safe defaults
- F007: Rule Engine - Unified rule evaluation orchestrating time rules (F005) and content rules (F006), time-first priority, RuleAction/RuleSource tracking, full serialization support
- F013: Authentication - Parent password protection with Argon2 hashing, session management (15min timeout), min 6 char validation, AuthManager/SessionToken/SessionManager types
- F019: User Profiles - Per-child profiles with OS username auto-detection, time/content rules per profile, ProfileManager for lookup, ProfileRepo for persistence, child-safe presets
- F009: HTTP API - Local server (127.0.0.1:8765) with CORS, endpoints: POST /api/check (<100ms), GET /api/stats, GET /api/logs, GET/PUT /api/rules (auth for PUT), POST /api/auth/verify
- F010: Browser Extension - Chrome MV3 extension with content script interception on ChatGPT/Claude/Gemini, checking overlay, block/warn/allow states, service status popup, site-specific handlers
- F011: System Tray - Cross-platform system tray with status indicators (protected/paused/error), menu (Dashboard, Settings, Logs, Pause/Resume, Quit), dynamic shield icon generation, event polling for menu actions
- F012: Parent Dashboard - Native egui desktop GUI with password protection (Argon2), session timeout (15min), sidebar navigation (Dashboard/Profiles/Logs/Settings), summary statistics cards, profile CRUD with editor dialog, time/content rules tabs, activity logs with search/filter/export (CSV), settings with mode selection and password change
- F018: Protection Toggle - Auth-guarded pause/disable with ProtectionState (Active/Paused/Disabled), PauseDuration presets (5min/15min/30min/1hr/indefinite), auto-resume on timed pause expiry, ProtectionManager with thread-safe state, storage persistence via config key-value store
- F014: Notifications - Cross-platform desktop notifications (notify-rust) for blocked content, rate-limited (1/min), shows site and category, enable/disable setting, optional feature flag
- F016: MITM Proxy - Transparent HTTPS proxy (hudsucker) for intercepting LLM traffic across all apps, root CA generation on first run, per-domain certificates on-the-fly, LLM domain filtering (OpenAI/Anthropic/Google), prompt extraction from request bodies, classification and rule engine integration (F007), block page injection, callbacks for block/allow events, graceful shutdown support
- F017: Interception Mode - Mode switching between Browser Extension and MITM Proxy with auth-guarded toggling, InterceptionMode enum (Extension/Proxy), InterceptionManager for thread-safe state, mode info for UI display (name, description, coverage, CA cert requirements), default Extension mode for simpler setup, storage persistence via restore_mode
- F015: First-Run Setup - Multi-step setup wizard for new users with 7 steps (Welcome, Password, Protection Level, Interception Mode, CA Install, Profile, Complete), SetupStep/SetupWizardState/ProtectionLevel enums, protection level presets (Standard/Strict/Custom) with default time/content rules, interception mode selection with CA skipping for Extension mode, OS-specific CA installation instructions (Windows/macOS/Linux), first profile creation with OS username auto-detection option
- F020: Clean Uninstall - Auth-protected uninstall with UninstallManager, UninstallOptions, UninstallResult types, parent password verification required, data file deletion (database, CA certs, config), log export to CSV before deletion, OS-specific CA removal instructions (Windows certutil, macOS security command, Linux update-ca-certificates), UninstallPaths for data directory discovery, confirmation text generation for UI
- F028: Background Service Mode - Tray-first invisible operation with no console window (Windows subsystem attribute), system tray as primary interface, dashboard opens on demand via tray menu, file-based logging with daily rotation (tracing-appender, 5 file retention), in-dashboard log viewer with level filtering and search, CLI flags (--no-tray, --debug, --log-level, --show-dashboard), first-run detection opens dashboard, Windows message pump for tray event handling
- F030: Autostart & Persistence - Cross-platform autostart using auto-launch crate (Windows registry, macOS LaunchAgent, Linux .desktop), --minimized flag for silent startup, Settings UI toggle with lock option, first-run setup checkbox (enabled by default), autostart removal on uninstall, parent auth-guarded lock setting to prevent tampering
- F029: Profile-Aware Proxy - Auto-enable/disable proxy based on OS user profile with ProfileProxyController, ProxyMode enum (Enabled/Disabled/Passthrough), ProfileType enum (Child/Parent), ProxyAction enum for tracking actions, ProfileSwitchEvent for logging profile changes, polling-based OS user detection with debouncing, configurable unknown user handling (EnableWithDefaults/DisableFiltering/Passthrough), on_switch and on_proxy_action callbacks, profile-based protection state management
- F025: Community Rules - Layered rule system with three tiers (Community/Curated/Parent), CommunityRuleManager for managing rules, RuleTier enum for priority ordering, Severity enum (Mild/Moderate/Strong/Severe) with confidence mapping, RuleSource for tracking rule origins (Surge AI, LDNOOBW, JailbreakBench, PromptInject), ParentOverrides for whitelist/blacklist/disabled rules, format loaders (JSON/CSV/TXT), multi-language support with locale detection, Profanity category added to Category enum, CompiledRuleSet for efficient regex matching, bundled Aegis-curated rules for jailbreak/violence/selfharm/adult/hate/illegal patterns
